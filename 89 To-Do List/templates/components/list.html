<div class="container my-4">
  <form action="{{ url_for('edit', route=list.route, view=view) }}" method="post">
    <div class="d-flex justify-content-between">
      <h2 id="{{ list.title.replace(' ', '') }}" class="{{ 'text-primary' if list.is_today }}">{{ list.title }}</h2>
      {% if editing == list.title %}
        <button class="bi bi-check-lg text-primary icon-button" type="submit"></button>
      {% elif not editing %}
        <a class="bi bi-pencil text-primary" href="{{ url_for(list.route, view=view, editing=list.title) }}"></a>
      {% endif %}
    </div>
    <ul class="list-group list-group-flush">
      {% with items = list['items'] %}
        {% for item in items %}
          <li class="list-group-item">
            {% if editing == list.title %}
              <a class="bi bi-x-square text-danger me-3" href="{{ url_for('delete', list_item_id=item.id, route=list.route, view=view, editing=list.title) }}"></a>
              <input class="list-input{{ ' text-decoration-line-through' if item.is_completed else ' text-danger' if item.due_date < today_date }}" type="text" name="text_{{ item.id }}" value="{{ item.text }}">
              <input class="date-input{{ ' text-decoration-line-through' if item.is_completed }}" type="date" name="date_{{ item.id }}" value="{{ item.due_date }}">
            {% else %}
              <a class="bi{{ ' bi-check-square-fill' if item.is_completed else ' bi-square' }} me-3" href="{{ url_for('toggle', list_item_id=item.id, route=list.route, view=view) }}"></a>
              {% if item.due_date < today_date %}
                <input class="list-input{{ ' text-decoration-line-through' if item.is_completed else ' text-danger' }}" type="text" value="{{ item.text }}">
                {% if view != 'month' %}
                  <span class="date-input{{ ' text-decoration-line-through' if item.is_completed else ' text-danger' }}">{{ item.due_date.strftime('%b %-d') }}</span>
                {% endif %}
              {% else %}
                <input class="list-input{{ ' text-decoration-line-through' if item.is_completed }}" type="text" value="{{ item.text }}">
                {% if list.title == 'This Week' %}
                  <span class="date-input{{ ' text-decoration-line-through' if item.is_completed }}">{{ item.due_date.strftime('%A') }}</span>
                {% elif list.title in ['This Month', 'Future'] or view == 'year' %}
                  <span class="date-input{{ ' text-decoration-line-through' if item.is_completed }}">{{ item.due_date.strftime('%b %-d') }}</span>
                {% endif %}
              {% endif %}
            {% endif %}
          </li>
        {% endfor %}
      {% endwith %}
    </ul>
  </form>
  {% if editing == list.title %}
      <li class="list-group-item">
        <form action="{{ url_for(list.route, view=view) }}" method="post">
          <input id="newItem" class="form-control" type="text" name="{{ list.title }}" placeholder="New item" autofocus>
          <input type="text" style="display: none" name="new_item_due_date" value="{{ list.new_item_due_date }}">
          <input type="submit" style="display: none"/>
        </form>
      </li>
    {% endif %}
</div>
<script>
  document.getElementById('newItem').focus()
</script>